(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-425592f4"],{2378:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"title"},[a("h2",[a("b",[t._v(t._s(t.$t("graphics.sankeys.title")))])])]),a("br"),t.load?t._e():a("div",{staticClass:"load-c"},[a("div",{staticClass:"loader"},[a("div",[a("ul",[a("li",[a("svg",{attrs:{viewBox:"0 0 90 120",fill:"currentColor"}},[a("path",{attrs:{d:"M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z"}})])]),a("li",[a("svg",{attrs:{viewBox:"0 0 90 120",fill:"currentColor"}},[a("path",{attrs:{d:"M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z"}})])]),a("li",[a("svg",{attrs:{viewBox:"0 0 90 120",fill:"currentColor"}},[a("path",{attrs:{d:"M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z"}})])]),a("li",[a("svg",{attrs:{viewBox:"0 0 90 120",fill:"currentColor"}},[a("path",{attrs:{d:"M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z"}})])]),a("li",[a("svg",{attrs:{viewBox:"0 0 90 120",fill:"currentColor"}},[a("path",{attrs:{d:"M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z"}})])]),a("li",[a("svg",{attrs:{viewBox:"0 0 90 120",fill:"currentColor"}},[a("path",{attrs:{d:"M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z"}})])])])]),a("span",[t._v(t._s(t.$t("graphics.cal_graphs")))])])]),a("div",{staticClass:"contain-pro"},[a("div",{staticClass:"list"},t._l(t.nodes,(function(e,r){return a("div",{key:r,staticClass:"item"},[a("div",{staticClass:"icon",style:"background-color: "+t.listColors[r]}),t._v(" "),a("div",[t._v(t._s(e["ETIQUETA"])+" - "+t._s(e["Leyenda"])+" ")]),a("br"),a("br")])})),0),t._m(0)])])},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wrap"},[a("div",{attrs:{id:"chart"}})])}],o=a("1da1"),s=(a("9911"),a("4e82"),a("b0c0"),a("ac1f"),a("5319"),a("4de4"),a("1276"),a("96cf"),{data:function(){return{nodes:[],links:[],year:null,idDes:null,formulaAlias:[],ansd:[],ques:[],figures:[],variables:[],references:[],constants_calculated:{table:"REG_TAB",sum:"SUMATORIA",simple:"CALC_SIMPLE",compose:"CALC_COMPUESTO",equal:"IGUAL"},loaded:!1,listColors:[],load:!1}},mounted:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,r,n,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.year=localStorage.getItem("year"),t.idDes=localStorage.getItem("id_territorio"),t.$store.dispatch("setLoading"),e.prev=3,e.next=6,window.eel.getQuestion()(a);case 6:a=e.sent,t.ques=JSON.parse(a),t.$store.dispatch("clearLoading"),e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](3),console.log(e.t0),t.$store.dispatch("clearLoading");case 15:return t.$store.dispatch("setLoading"),e.prev=16,e.next=19,window.eel.getAnswerUserD(t.year,t.idDes)(r);case 19:r=e.sent,t.ansd=JSON.parse(r),null==t.ansd&&(t.ansd=[]),t.$store.dispatch("clearLoading"),e.next=29;break;case 25:e.prev=25,e.t1=e["catch"](16),console.log(e.t1),t.$store.dispatch("clearLoading");case 29:return t.$store.dispatch("setLoading"),e.prev=30,e.next=33,window.eel.getVariables()(n);case 33:n=e.sent,t.variables=JSON.parse(n),t.$store.dispatch("clearLoading"),e.next=43;break;case 38:e.prev=38,e.t2=e["catch"](30),console.log(e.t2),t.isLoad=!0,t.$store.dispatch("clearLoading");case 43:return t.$store.dispatch("setLoading"),e.prev=44,e.next=47,window.eel.getFormulaByAlias()(o);case 47:o=e.sent,t.formulaAlias=JSON.parse(o),t.$store.dispatch("clearLoading"),e.next=56;break;case 52:e.prev=52,e.t3=e["catch"](44),console.log(e.t3),t.$store.dispatch("clearLoading");case 56:return t.$store.dispatch("setLoading"),e.prev=57,e.next=60,window.eel.getReferences(t.year,t.idDes)(s);case 60:s=e.sent,t.references=JSON.parse(s),t.$store.dispatch("clearLoading"),e.next=69;break;case 65:e.prev=65,e.t4=e["catch"](57),console.log(e.t4),t.$store.dispatch("clearLoading");case 69:t.loadSakey();case 70:case"end":return e.stop()}}),e,null,[[3,11],[16,25],[30,38],[44,52],[57,65]])})))()},methods:{loadSakey:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$store.dispatch("setLoading"),e.prev=1,e.next=4,window.eel.getSankeyNodes()(a);case 4:a=e.sent,t.nodes=JSON.parse(a),setTimeout(Object(o["a"])(regeneratorRuntime.mark((function e(){var a,r,n,o,s,l,i,c,d,u,_,p,f,C,g,h,L,v,O,x;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,x=function(t){d3.select(this).attr("transform","translate("+t.x+","+(t.y=Math.max(0,Math.min(o-t.dy,d3.event.y)))+")"),d.relayout(),L.attr("d",u)},e.next=4,window.eel.getSankeyLinks()(a);case 4:for(a=e.sent,t.links=JSON.parse(a),r={top:1,right:1,bottom:6,left:1},n=960-r.left-r.right,o=500-r.top-r.bottom,s=d3.format(",.2f"),l=function(t){return s(t)+" Ton/año"},i=d3.scale.category20(),c=d3.select("#chart").append("svg").attr("width",n+r.left+r.right).attr("height",o+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")"),d=d3.sankey().nodeWidth(15).nodePadding(10).size([n,o]),u=d.link(),_=[],p=[],f=0;f<t.nodes.length;f++)_.push({name:t.nodes[f]["ETIQUETA"]});for(C=function(e){var a=t.getCalculated(t.formulaAlias.filter((function(a){return a.id_cal==t.links[e]["ID_FORMULA"]}))[0]);p.push({source:t.links[e]["NODO_O"],target:t.links[e]["NODOD"],value:isNaN(a)?0:0==a?1:a})},g=0;g<t.links.length;g++)C(g);h={nodes:_,links:p},console.log(h),d.nodes(h.nodes).links(h.links).layout(32),L=c.append("g").selectAll(".link").data(h.links).enter().append("path").attr("class","link").attr("d",u).style("stroke-width",(function(t){return Math.max(1,t.dy)})).sort((function(t,e){return e.dy-t.dy})),L.append("title").text((function(t){return t.source.name+" → "+t.target.name+"\n"+l(t.value)})),v=c.append("g").selectAll(".node").data(h.nodes).enter().append("g").attr("class","node").attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})).call(d3.behavior.drag().origin((function(t){return t})).on("dragstart",(function(){this.parentNode.appendChild(this)})).on("drag",x)),O=t,v.append("rect").attr("height",(function(t){return t.dy})).attr("width",d.nodeWidth()).style("fill",(function(t){return O.listColors.push(i(t.name.replace(/ .*/,""))),t.color=i(t.name.replace(/ .*/,""))})).style("stroke",(function(t){return d3.rgb(t.color).darker(2)})).append("title").text((function(t){return t.name+"\n"+l(t.value)})),v.append("text").attr("x",-6).attr("y",(function(t){return t.dy/2})).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text((function(t){return t.name})).filter((function(t){return t.x<n/2})).attr("x",6+d.nodeWidth()).attr("text-anchor","start"),t.load=!0,e.next=32;break;case 28:e.prev=28,e.t0=e["catch"](0),console.log(e.t0),console.log("in index");case 32:case"end":return e.stop()}}),e,null,[[0,28]])}))),500),t.$store.dispatch("clearLoading"),e.next=15;break;case 10:e.prev=10,e.t0=e["catch"](1),console.log(e.t0),console.log("in index "),t.$store.dispatch("clearLoading");case 15:case"end":return e.stop()}}),e,null,[[1,10]])})))()},getAnswerValues:function(t){var e=this.ansd.filter((function(e){return e.id_pregunta==parseInt(t)}))[0];return e},getQuestions:function(t){var e=this.ques.filter((function(e){return e["ID_PREGUNTA"]==parseInt(t)}))[0];return e},getAliasFormula:function(t){return this.formulaAlias.filter((function(e){return e.id_cal==parseInt(t.split("!")[1])}))[0]},getRefValue:function(t){return this.references.filter((function(e){return e["ID_REFERENCIA"]==t}))[0]},getCalculated:function(t){if(void 0==t)return 0;if(t.length<1)return 0;if(t.tipo==this.constants_calculated.sum){var e=t["CPO"].split(";"),a=[];console.log("________________"),console.log(JSON.stringify(t));for(var r=0;r<e.length;r++){var n=e[r].split("&")[1],o=this.getAnswerValues(parseInt(n));void 0!=o&&(null!=o["dato_text"]&&void 0!=o["dato_text"]&&""!=o["dato_text"]?(a.push(parseFloat(o["dato_text"])),console.log("Val text "+r+": "+parseFloat(o["dato_text"]))):null!=o["dato_calc1"]&&void 0!=o["dato_calc1"]&&""!=o["dato_calc1"]?(a.push(parseFloat(o["dato_calc1"])),console.log("Val calc "+r+": "+o["dato_calc1"]+",  parsed: "+parseFloat(o["dato_calc1"]))):(a.push(0),console.log("Val null "+r+": 0")))}var s=a.reduce((function(t,e){return t+e}),0);return console.log(s),s}if(t.tipo==this.constants_calculated.simple){var l=this.simpleCalculated(t);return console.log(l),l}if(t.tipo==this.constants_calculated.compose){var i=this.simpleCalculated(t);return console.log(i),i}if(t.tipo==this.constants_calculated.equal){var c=this.simpleCalculated(t);return console.log(c),c}},simpleCalculated:function(t){if(t.tipo==this.constants_calculated.sum){for(var e=t["CPO"].split(";"),a=[],r=0;r<e.length;r++){var n="NA";if(-1!=e[r].indexOf("&")&&(n="ID"),-1!=e[r].indexOf("!")&&(n="ALIAS"),"ID"==n){var o=e[r].split("&")[1],s=this.getAnswerValues(parseInt(o));parseFloat("____________________SUM"),void 0!=s&&(null!=s["dato_text"]&&void 0!=s["dato_text"]&&""!=s["dato_text"]?(console.log(parseFloat(s["dato_text"])),a.push(parseFloat(s["dato_text"]))):null!=s["dato_calc1"]&&void 0!=s["dato_calc1"]&&""!=s["dato_calc1"]?a.push(parseFloat(s["dato_calc1"])):a.push(0))}else if("ALIAS"==n){var l=this.getAliasFormula(e[r]);void 0!=l&&a.push(this.getCalculated(l))}}for(var i=0,c=0;c<a.length;c++)i+=a[c];return console.log(i),i}var d,u,_="NA",p="NA";-1!=t["CPO"].indexOf("&")&&(_="ID"),-1!=t["CPO"].indexOf("#")&&(_="VAR"),-1!=t["CPO"].indexOf("!")&&(_="ALIAS"),-1!=t["CPO"].indexOf("[")&&(_="CONST"),-1!=t["CPO"].indexOf("?")&&(_="REF"),-1!=t["CPO2"].indexOf("&")&&(p="ID"),-1!=t["CPO2"].indexOf("#")&&(p="VAR"),-1!=t["CPO2"].indexOf("!")&&(p="ALIAS"),-1!=t["CPO2"].indexOf("[")&&(p="CONST"),-1!=t["CPO2"].indexOf("?")&&(p="REF");var f={"+":function(t,e){return t+e},"-":function(t,e){return t-e},"/":function(t,e){return t/e},"*":function(t,e){return t*e},IGUAL:function(t,e){return e=0,t+e}};if("ID"==_){var C=t["CPO"].split("&")[1],g=this.getAnswerValues(parseInt(C)),h=this.getQuestions(parseInt(C));void 0!=h&&("abierto numero"==h["TIPO_1"]?void 0!=g&&(d=null!=g["dato_text"]&&void 0!=g["dato_text"]&&""!=g["dato_text"]?parseFloat(g["dato_text"]):0):"calculado"==h["TIPO_1"]&&void 0!=g&&(d=null!=g["dato_calc1"]&&void 0!=g["dato_calc1"]&&""!=g["dato_calc1"]?parseFloat(g["dato_calc1"]):0))}else if("VAR"==_){var L=this.variables.filter((function(e){return e["NOMBRE"]==t["CPO"]}))[0];d=L["VALOR"]}else if("ALIAS"==_){var v=this.getAliasFormula(t["CPO"]);void 0!=v&&(d=this.getCalculated(v))}else if("CONST"==_){var O=t["CPO"].split("[")[1],x=O.split("]")[0];d=parseFloat(x.replace(",","."))}else if("REF"==_){var m=t["CPO"].split("?")[1],A=this.getRefValue(m);void 0!=A&&(d=parseFloat(A["DATA"]))}if("ID"==p){var w=t["CPO2"].split("&")[1],k=this.getAnswerValues(parseInt(w)),P=this.getQuestions(parseInt(w));void 0!=P&&("abierto numero"==P["TIPO_1"]?void 0!=k&&(u=null!=k["dato_text"]&&void 0!=k["dato_text"]&&""!=k["dato_text"]?parseFloat(k["dato_text"]):0):"calculado"==P["TIPO_1"]&&void 0!=k&&(u=null!=k["dato_calc1"]&&void 0!=k["dato_calc1"]&&""!=k["dato_calc1"]?parseFloat(k["dato_calc1"]):0))}else if("VAR"==p){var I=this.variables.filter((function(e){return e["NOMBRE"]==t["CPO2"]}))[0];u=I["VALOR"]}else if("ALIAS"==p){var b=this.getAliasFormula(t["CPO2"]);void 0!=b&&(u=this.getCalculated(b))}else if("CONST"==p){var y=t["CPO2"].split("[")[1],M=y.split("]")[0];u=parseFloat(M.replace(",","."))}else if("REF"==p){var S=t["CPO2"].split("?")[1],F=this.getRefValue(S);void 0!=F&&(u=parseFloat(F["DATA"]))}return console.log("______________________________________________________________________"),console.log("CPD: "+t["CPD"]),console.log(d+t["OP"]+u+"="+f[t["OP"]](d,u)),console.log("CPO: "+t["CPO"]+" - "+_),console.log("CPO2: "+t["CPO2"]+" - "+p),console.log("ALIAS: "+t["alias"]),console.log(JSON.stringify(t)),console.log(t["OP"]),f[t["OP"]](d,u)}}}),l=s,i=(a("f586"),a("2877")),c=Object(i["a"])(l,r,n,!1,null,"21dda8a4",null);e["default"]=c.exports},"857a":function(t,e,a){var r=a("1d80"),n=a("577e"),o=/"/g;t.exports=function(t,e,a,s){var l=n(r(t)),i="<"+e;return""!==a&&(i+=" "+a+'="'+n(s).replace(o,"&quot;")+'"'),i+">"+l+"</"+e+">"}},9911:function(t,e,a){"use strict";var r=a("23e7"),n=a("857a"),o=a("af03");r({target:"String",proto:!0,forced:o("link")},{link:function(t){return n(this,"a","href",t)}})},af03:function(t,e,a){var r=a("d039");t.exports=function(t){return r((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}))}},b0c0:function(t,e,a){var r=a("83ab"),n=a("9bf2").f,o=Function.prototype,s=o.toString,l=/^\s*function ([^ (]*)/,i="name";r&&!(i in o)&&n(o,i,{configurable:!0,get:function(){try{return s.call(this).match(l)[1]}catch(t){return""}}})},f586:function(t,e,a){"use strict";a("fa34")},fa34:function(t,e,a){}}]);
//# sourceMappingURL=chunk-425592f4.b12ad52d.js.map