(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3ace2104"],{2378:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},r=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("div",{staticClass:"wrap"},[a("div",{attrs:{id:"chart"}})])])}],o=a("1da1"),s=(a("9911"),a("4e82"),a("b0c0"),a("ac1f"),a("5319"),a("4de4"),a("1276"),a("96cf"),{data:function(){return{nodes:[],links:[],year:null,idDes:null,formulaAlias:[],ansd:[],ques:[],figures:[],variables:[],references:[],constants_calculated:{table:"REG_TAB",sum:"SUMATORIA",simple:"CALC_SIMPLE",compose:"CALC_COMPUESTO",equal:"IGUAL"},loaded:!1}},mounted:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,n,r,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.year=localStorage.getItem("year"),t.idDes=localStorage.getItem("id_territorio"),t.$store.dispatch("setLoading"),e.prev=3,e.next=6,window.eel.getQuestion()(a);case 6:a=e.sent,t.ques=JSON.parse(a),t.$store.dispatch("clearLoading"),e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](3),console.log(e.t0),t.$store.dispatch("clearLoading");case 15:return t.$store.dispatch("setLoading"),e.prev=16,e.next=19,window.eel.getAnswerUserD(t.year,t.idDes)(n);case 19:n=e.sent,t.ansd=JSON.parse(n),null==t.ansd&&(t.ansd=[]),t.$store.dispatch("clearLoading"),e.next=29;break;case 25:e.prev=25,e.t1=e["catch"](16),console.log(e.t1),t.$store.dispatch("clearLoading");case 29:return t.$store.dispatch("setLoading"),e.prev=30,e.next=33,window.eel.getVariables()(r);case 33:r=e.sent,t.variables=JSON.parse(r),t.$store.dispatch("clearLoading"),e.next=43;break;case 38:e.prev=38,e.t2=e["catch"](30),console.log(e.t2),t.isLoad=!0,t.$store.dispatch("clearLoading");case 43:return t.$store.dispatch("setLoading"),e.prev=44,e.next=47,window.eel.getFormulaByAlias()(o);case 47:o=e.sent,t.formulaAlias=JSON.parse(o),t.$store.dispatch("clearLoading"),e.next=56;break;case 52:e.prev=52,e.t3=e["catch"](44),console.log(e.t3),t.$store.dispatch("clearLoading");case 56:return t.$store.dispatch("setLoading"),e.prev=57,e.next=60,window.eel.getReferences(t.year,t.idDes)(s);case 60:s=e.sent,t.references=JSON.parse(s),t.$store.dispatch("clearLoading"),e.next=69;break;case 65:e.prev=65,e.t4=e["catch"](57),console.log(e.t4),t.$store.dispatch("clearLoading");case 69:t.loadSakey();case 70:case"end":return e.stop()}}),e,null,[[3,11],[16,25],[30,38],[44,52],[57,65]])})))()},methods:{loadSakey:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$store.dispatch("setLoading"),e.prev=1,e.next=4,window.eel.getSankeyNodes()(a);case 4:a=e.sent,t.nodes=JSON.parse(a),setTimeout(Object(o["a"])(regeneratorRuntime.mark((function e(){var a,n,r,o,s,i,l,c,d,u,p,f,g,h,v,O,_,x,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,m=function(t){d3.select(this).attr("transform","translate("+t.x+","+(t.y=Math.max(0,Math.min(o-t.dy,d3.event.y)))+")"),d.relayout(),_.attr("d",u)},e.next=4,window.eel.getSankeyLinks()(a);case 4:for(a=e.sent,t.links=JSON.parse(a),n={top:1,right:1,bottom:6,left:1},r=960-n.left-n.right,o=500-n.top-n.bottom,s=d3.format(",.0f"),i=function(t){return s(t)+" TWh"},l=d3.scale.category20(),c=d3.select("#chart").append("svg").attr("width",r+n.left+n.right).attr("height",o+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),d=d3.sankey().nodeWidth(15).nodePadding(10).size([r,o]),u=d.link(),p=[],f=[],g=0;g<t.nodes.length;g++)p.push({name:t.nodes[g]["ETIQUETA"]});for(h=0;h<t.links.length;h++)v=t.getCalculated(t.links[h]["ID_FORMULA"]),f.push({source:t.links[h]["NODO_O"],target:t.links[h]["NODOD"],value:isNaN(v)?1:v});O={nodes:p,links:f},console.log(O),d.nodes(O.nodes).links(O.links).layout(32),_=c.append("g").selectAll(".link").data(O.links).enter().append("path").attr("class","link").attr("d",u).style("stroke-width",(function(t){return Math.max(1,t.dy)})).sort((function(t,e){return e.dy-t.dy})),_.append("title").text((function(t){return t.source.name+" â†’ "+t.target.name+"\n"+i(t.value)})),x=c.append("g").selectAll(".node").data(O.nodes).enter().append("g").attr("class","node").attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})).call(d3.behavior.drag().origin((function(t){return t})).on("dragstart",(function(){this.parentNode.appendChild(this)})).on("drag",m)),x.append("rect").attr("height",(function(t){return t.dy})).attr("width",d.nodeWidth()).style("fill",(function(t){return t.color=l(t.name.replace(/ .*/,""))})).style("stroke",(function(t){return d3.rgb(t.color).darker(2)})).append("title").text((function(t){return t.name+"\n"+i(t.value)})),x.append("text").attr("x",-6).attr("y",(function(t){return t.dy/2})).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text((function(t){return t.name})).filter((function(t){return t.x<r/2})).attr("x",6+d.nodeWidth()).attr("text-anchor","start"),e.next=29;break;case 25:e.prev=25,e.t0=e["catch"](0),console.log(e.t0),console.log("in index");case 29:case"end":return e.stop()}}),e,null,[[0,25]])}))),500),t.$store.dispatch("clearLoading"),e.next=15;break;case 10:e.prev=10,e.t0=e["catch"](1),console.log(e.t0),console.log("in index "),t.$store.dispatch("clearLoading");case 15:case"end":return e.stop()}}),e,null,[[1,10]])})))()},getAnswerValues:function(t){var e=this.ansd.filter((function(e){return e.id_pregunta==parseInt(t)}))[0];return e},getQuestions:function(t){var e=this.ques.filter((function(e){return e["ID_PREGUNTA"]==parseInt(t)}))[0];return e},getAliasFormula:function(t){return this.formulaAlias.filter((function(e){return e.alias==t}))[0]},getRefValue:function(t){return this.references.filter((function(e){return e["ID_REFERENCIA"]==t}))[0]},getCalculated:function(t){if(void 0==t)return 0;if(t.length<1)return 0;if(t.tipo==this.constants_calculated.sum){var e=t["CPO"].split(";"),a=[];console.log("________________");for(var n=0;n<e.length;n++){var r=e[n].split("&")[1],o=this.getAnswerValues(parseInt(r));console.log("answer with id"+r+": "+JSON.stringify(o)),void 0!=o&&(null!=o["dato_text"]&&void 0!=o["dato_text"]&&""!=o["dato_text"]?(a.push(parseFloat(o["dato_text"])),console.log("Val text "+n+": "+parseFloat(o["dato_text"]))):null!=o["dato_calc1"]&&void 0!=o["dato_calc1"]&&""!=o["dato_calc1"]?(a.push(parseFloat(o["dato_calc1"])),console.log("Val calc "+n+": "+o["dato_calc1"]+",  parsed: "+parseFloat(o["dato_calc1"]))):(a.push(0),console.log("Val null "+n+": 0")))}var s=a.reduce((function(t,e){return t+e}),0);return console.log(s),s}if(t.tipo==this.constants_calculated.simple){var i=this.simpleCalculated(t);return console.log(i),i}if(t.tipo==this.constants_calculated.compose){var l=this.simpleCalculated(t);return console.log(l),l}if(t.tipo==this.constants_calculated.equal){var c=this.simpleCalculated(t);return console.log(c),c}},simpleCalculated:function(t){var e,a,n="NA",r="NA";-1!=t["CPO"].indexOf("&")&&(n="ID"),-1!=t["CPO"].indexOf("#")&&(n="VAR"),-1!=t["CPO"].indexOf("!")&&(n="ALIAS"),-1!=t["CPO"].indexOf("[")&&(n="CONST"),-1!=t["CPO"].indexOf("?")&&(n="REF"),-1!=t["CPO2"].indexOf("&")&&(r="ID"),-1!=t["CPO2"].indexOf("#")&&(r="VAR"),-1!=t["CPO2"].indexOf("!")&&(r="ALIAS"),-1!=t["CPO2"].indexOf("[")&&(r="CONST"),-1!=t["CPO2"].indexOf("?")&&(r="REF");var o={"+":function(t,e){return t+e},"-":function(t,e){return t-e},"/":function(t,e){return t/e},"*":function(t,e){return t*e},IGUAL:function(t,e){return e=0,t+e}};if("ID"==n){var s=t["CPO"].split("&")[1],i=this.getAnswerValues(parseInt(s)),l=this.getQuestions(parseInt(s));void 0!=l&&("abierto numero"==l["TIPO_1"]?void 0!=i&&(e=null!=i["dato_text"]&&void 0!=i["dato_text"]&&""!=i["dato_text"]?parseFloat(i["dato_text"]):0):"calculado"==l["TIPO_1"]&&void 0!=i&&(e=null!=i["dato_calc1"]&&void 0!=i["dato_calc1"]&&""!=i["dato_calc1"]?parseFloat(i["dato_calc1"]):0))}else if("VAR"==n){var c=this.variables.filter((function(e){return e["NOMBRE"]==t["CPO"]}))[0];e=c["VALOR"]}else if("ALIAS"==n){var d=this.getAliasFormula(t["CPO"]);void 0!=d&&(e=this.getCalculated(d))}else if("CONST"==n){var u=t["CPO"].split("[")[1],p=u.split("]")[0];e=parseFloat(p.replace(",","."))}else if("REF"==n){var f=t["CPO"].split("?")[1],g=this.getRefValue(f);void 0!=g&&(e=parseFloat(g["DATA"]))}if("ID"==r){var h=t["CPO2"].split("&")[1],v=this.getAnswerValues(parseInt(h)),O=this.getQuestions(parseInt(h));void 0!=O&&("abierto numero"==O["TIPO_1"]?void 0!=v&&(a=null!=v["dato_text"]&&void 0!=v["dato_text"]&&""!=v["dato_text"]?parseFloat(v["dato_text"]):0):"calculado"==O["TIPO_1"]&&void 0!=v&&(a=null!=v["dato_calc1"]&&void 0!=v["dato_calc1"]&&""!=v["dato_calc1"]?parseFloat(v["dato_calc1"]):0))}else if("VAR"==r){var _=this.variables.filter((function(e){return e["NOMBRE"]==t["CPO2"]}))[0];a=_["VALOR"]}else if("ALIAS"==r){var x=this.getAliasFormula(t["CPO2"]);void 0!=x&&(a=this.getCalculated(x))}else if("CONST"==r){var m=t["CPO2"].split("[")[1],A=m.split("]")[0];a=parseFloat(A.replace(",","."))}else if("REF"==r){var C=t["CPO2"].split("?")[1],w=this.getRefValue(C);void 0!=w&&(a=parseFloat(w["DATA"]))}return t.tipo,this.constants_calculated.compose,console.log(JSON.stringify(t)),console.log(t["OP"]),o[t["OP"]](e,a)}}}),i=s,l=a("2877"),c=Object(l["a"])(i,n,r,!1,null,"b3750bce",null);e["default"]=c.exports},"857a":function(t,e,a){var n=a("1d80"),r=a("577e"),o=/"/g;t.exports=function(t,e,a,s){var i=r(n(t)),l="<"+e;return""!==a&&(l+=" "+a+'="'+r(s).replace(o,"&quot;")+'"'),l+">"+i+"</"+e+">"}},9911:function(t,e,a){"use strict";var n=a("23e7"),r=a("857a"),o=a("af03");n({target:"String",proto:!0,forced:o("link")},{link:function(t){return r(this,"a","href",t)}})},af03:function(t,e,a){var n=a("d039");t.exports=function(t){return n((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}))}},b0c0:function(t,e,a){var n=a("83ab"),r=a("9bf2").f,o=Function.prototype,s=o.toString,i=/^\s*function ([^ (]*)/,l="name";n&&!(l in o)&&r(o,l,{configurable:!0,get:function(){try{return s.call(this).match(i)[1]}catch(t){return""}}})}}]);
//# sourceMappingURL=chunk-3ace2104.e4711599.js.map